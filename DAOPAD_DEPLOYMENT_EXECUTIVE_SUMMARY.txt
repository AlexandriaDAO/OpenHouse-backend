================================================================================
            DAOPAD BUILD AND DEPLOYMENT PROCESS - EXECUTIVE SUMMARY
================================================================================

PROJECT: Alexandria DAO - DAOPad Frontend and Backend
LOCATION: /home/theseus/alexandria/daopad/
NETWORK: Mainnet (IC) Only - NO Local Testing Environment
STRATEGY: Deploy Everything Directly to Production

================================================================================
                          KEY FINDINGS
================================================================================

1. MAINNET-ONLY ENFORCEMENT
   - No local network configuration in dfx.json
   - All canister IDs hardcoded for mainnet only
   - CLAUDE.md explicitly states: "There is no local testing environment - all 
     testing happens on mainnet"
   - Every code change goes directly to production

2. THREE-CANISTER ARCHITECTURE (All Mainnet)
   - Backend (lwsav-iiaaa-aaaap-qp2qq-cai): Creates Orbit requests only
   - Admin (odkrm-viaaa-aaaap-qp2oq-cai): Handles voting and approvals
   - Frontend (l7rlj-6aaaa-aaaap-qp2ra-cai): User interface asset canister
   - Separation prevents canister from approving its own requests

3. CRITICAL DECLARATION SYNC BUG
   - Frontend reads from: src/daopad/daopad_frontend/src/declarations/
   - DFX generates to: src/declarations/
   - Auto-handled by deploy.sh BUT is a known pain point
   - Failure symptom: "TypeError: actor.method_name is not a function"

4. PASSWORDLESS DEPLOYMENT IDENTITY
   - daopad identity: No password required (designed for Claude automation)
   - Auto-switches to daopad when using --network ic
   - Has admin/operator access to test station (fec7w-zyaaa-aaaaa-qaffq-cai)
   - Warning suppression: export DFX_WARNING=-mainnet_plaintext_identity

5. DEPLOYMENT SCRIPT QUALITY
   - Location: /home/theseus/alexandria/daopad/src/daopad/deploy.sh
   - ~400 lines of well-documented bash
   - Handles all complexity: identity switching, declaration sync, testing
   - Options: --network ic, --backend-only, --frontend-only, --test, --fresh

================================================================================
                      DEPLOYMENT WORKFLOW
================================================================================

STEP 1: Make Code Changes
  - Edit Rust code in: src/daopad/daopad_backend/
  - Edit Frontend code in: src/daopad/daopad_frontend/
  - Edit Admin logic in: src/daopad/admin/

STEP 2: Deploy to Mainnet
  cd /home/theseus/alexandria/daopad/src/daopad/
  ./deploy.sh --network ic

STEP 3: Post-Deployment Verification
  ./deploy.sh --network ic --test
  
  Tests 13+ backend methods for functionality

STEP 4: Commit and Create PR
  git add .
  git commit -m "Deploy changes to mainnet canisters"
  git push

================================================================================
                    CLAUDE-SPECIFIC SETUP
================================================================================

DOCUMENTATION:
  File: /home/theseus/alexandria/daopad/src/daopad/CLAUDE.md
  Content: Complete workflow guide with:
    - Deployment instructions
    - Two-canister architecture explanation
    - Declaration sync bug and fix
    - Orbit Station integration process
    - Security checks
    - Common issues and solutions

PERMISSIONS:
  File: /home/theseus/alexandria/daopad/src/daopad/.claude/settings.local.json
  Allows:
    - All dfx canister operations
    - Specific Orbit Station test calls
    - Git operations (pull, add, commit, push)
    - Read access to entire daopad directory

GITHUB WORKFLOWS:
  - claude.yml: Interactive - responds to @claude mentions in issues/PRs
  - claude-code-review.yml: Auto-review on PR open/sync (code review only)
  - No automatic deployment (manual via ./deploy.sh)

================================================================================
                  CRITICAL FILES AND LOCATIONS
================================================================================

DEPLOYMENT SCRIPT:
  /home/theseus/alexandria/daopad/src/daopad/deploy.sh (400 lines)

DOCUMENTATION:
  /home/theseus/alexandria/daopad/src/daopad/CLAUDE.md (comprehensive)
  /home/theseus/alexandria/daopad/src/daopad/CLAUDE.md.old (archived)

CONFIGURATION:
  /home/theseus/alexandria/daopad/canister_ids.json (mainnet IDs only)
  /home/theseus/alexandria/daopad/dfx.json (DFX configuration)
  /home/theseus/alexandria/daopad/Makefile (legacy, not used)

TESTING:
  /home/theseus/alexandria/daopad/src/daopad/scripts/test-deployment.sh (smoke tests)
  /home/theseus/alexandria/daopad/src/daopad/scripts/verify-declarations.sh (sync check)
  /home/theseus/alexandria/daopad/src/daopad/scripts/test-frontend-integration.sh

PERMISSIONS:
  /home/theseus/alexandria/daopad/.claude/settings.local.json (Claude access)
  /home/theseus/alexandria/daopad/src/daopad/.claude/settings.local.json (local override)

GITHUB:
  /home/theseus/alexandria/daopad/.github/workflows/claude.yml (interactive)
  /home/theseus/alexandria/daopad/.github/workflows/claude-code-review.yml (auto-review)

================================================================================
                  MAINNET CANISTER IDS
================================================================================

daopad_backend      lwsav-iiaaa-aaaap-qp2qq-cai   Rust canister
admin               odkrm-viaaa-aaaap-qp2oq-cai   Rust canister
daopad_frontend     l7rlj-6aaaa-aaaap-qp2ra-cai   Asset canister
daopad_invoices     heuuj-6aaaa-aaaag-qc6na-cai   Rust canister
kong_locker         eazgb-giaaa-aaaap-qqc2q-cai   Reference
kong_locker_frnd    c6w56-taaaa-aaaai-atlma-cai   Reference
orbit_station_test  fec7w-zyaaa-aaaaa-qaffq-cai   Testing (daopad access)

================================================================================
                  COMPLETE DEPLOYMENT OPTIONS
================================================================================

Deploy All:
  ./deploy.sh --network ic

Deploy Backend Only:
  ./deploy.sh --network ic --backend-only

Deploy Frontend Only:
  ./deploy.sh --network ic --frontend-only

Deploy with Testing:
  ./deploy.sh --network ic --test

Fresh Local (dev only):
  ./deploy.sh --fresh

Help/Usage:
  ./deploy.sh --help

================================================================================
                  DEPLOYMENT SAFEGUARDS
================================================================================

1. Identity Control
   - Automatically switches to 'daopad' identity for mainnet
   - Prevents accidental use of wrong credentials
   - Warning suppression built-in for automation

2. Canister IDs
   - All specified_id values hardcoded in dfx.json
   - Prevents accidental deployment to wrong canisters
   - Cannot change without editing code

3. Declaration Sync
   - Auto-sync built into deploy script
   - Verification script available for checking sync status
   - Failure causes "is not a function" errors (caught by tests)

4. Role Separation
   - Backend cannot approve its own requests (operator role only)
   - Admin cannot create requests (admin role only)
   - Enforced by Orbit Station security model

5. Test Station Validation
   - Use fec7w-zyaaa-aaaaa-qaffq-cai for testing before live changes
   - daopad identity has admin access
   - Deterministic 4-step validation process documented in CLAUDE.md

6. Post-Deployment Testing
   - 13+ smoke tests verify backend functionality
   - Frontend integration tests validate UI
   - Tests run automatically with --test flag

================================================================================
                   UNIQUE DESIGN DECISIONS
================================================================================

WHY MAINNET-ONLY?
  - Forces frontend-backend sync (no local drift)
  - Every change immediately tested in real conditions
  - Single source of truth (production)
  - Reduces bugs from local/mainnet divergence

DECLARATION SYNC BUG (Known Issue):
  - Frontend and DFX generate to different locations
  - Automatically handled but is a potential pain point
  - Documented in CLAUDE.md as critical issue
  - Could be fixed with build system changes (not done)

PASSWORD-FREE IDENTITY:
  - Designed for CI/CD and automation
  - Required for Claude to deploy without user interaction
  - Risk: Identity stored plaintext in system (by design)
  - Mitigated: Limited to test station with no real funds

TWO-CANISTER SEPARATION:
  - Complies with Orbit Station governance model
  - Backend has operator role (create requests only)
  - Admin has admin role (approve after community vote)
  - Prevents any single component from hijacking governance

================================================================================
                    WHAT TO KNOW BEFORE DEPLOYING
================================================================================

1. ALWAYS use ./deploy.sh from src/daopad/ directory, NOT root
2. Mainnet deployment is MANDATORY for testing
3. Declaration sync is automatic but verify with scripts/verify-declarations.sh
4. Identity automatically switches to 'daopad' for mainnet
5. Post-deployment tests are critical: ./deploy.sh --network ic --test
6. If tests fail, fix code and redeploy (no rollback mechanism)
7. All canister IDs are locked to mainnet (no local override)
8. Test Station (fec7w-zyaaa-aaaaa-qaffq-cai) is available for validation
9. daopad identity has admin access to test station for Orbit calls
10. Every code change goes directly to production (no staging environment)

================================================================================
                      COMMON OPERATIONS
================================================================================

Full Mainnet Deployment:
  cd src/daopad/ && ./deploy.sh --network ic

Verify Deployment Success:
  ./deploy.sh --network ic --test

Check Declaration Sync:
  ./scripts/verify-declarations.sh

Backend Changes Only:
  ./deploy.sh --network ic --backend-only

Frontend Changes Only:
  ./deploy.sh --network ic --frontend-only

Manual DFX Test (before implementation):
  dfx canister --network ic call [canister-id] [method] '[args]'

Verify Backend Principal:
  dfx canister --network ic call lwsav-iiaaa-aaaap-qp2qq-cai get_backend_principal

Test Orbit Station Access:
  dfx canister --network ic call fec7w-zyaaa-aaaaa-qaffq-cai list_requests '(record {})'

================================================================================
                    TROUBLESHOOTING CHECKLIST
================================================================================

ERROR: "TypeError: actor.method_name is not a function"
  1. Run: ./scripts/verify-declarations.sh
  2. If mismatch, copy: cp -r src/declarations/daopad_backend/* src/daopad/daopad_frontend/src/declarations/daopad_backend/
  3. Redeploy: ./deploy.sh --network ic --frontend-only

ERROR: "DFX command not found"
  1. Install DFX: sh -c '$(curl -fsSL https://sdk.dfinity.org/install.sh)'
  2. Restart terminal

ERROR: "dfx is not running" (only for local)
  1. Start: dfx start --background --host 127.0.0.1:4943
  2. Note: DAOPad doesn't support local, so this shouldn't happen

ERROR: "Identity not found: daopad"
  1. Identity must be pre-configured (not automated)
  2. Contact team lead for identity setup

ERROR: Permission denied on mainnet
  1. Verify daopad identity has admin/operator roles
  2. Check test station status: dfx canister --network ic call fec7w-zyaaa-aaaaa-qaffq-cai list_users '(record {})'

ERROR: Deployment succeeds but frontend doesn't update
  1. Clear browser cache
  2. Check frontend canister ID: dfx canister --network ic id daopad_frontend
  3. Visit: https://[canister-id].icp0.io/

================================================================================
                   CRITICAL SUCCESS FACTORS
================================================================================

1. ALWAYS deploy to mainnet - there is no local environment
2. ALWAYS verify declarations after backend changes
3. ALWAYS run smoke tests after deployment
4. ALWAYS test with dfx FIRST before implementing Orbit integration
5. NEVER try to deploy to local (not supported)
6. NEVER modify reference directories (orbit-reference, kong-locker-reference)
7. NEVER skip declaration sync (causes "is not a function" errors)
8. NEVER change hardcoded canister IDs without approval

================================================================================

GENERATED: 2025-11-12
PROJECT: Alexandria DAO - DAOPad
DEPLOYMENT STRATEGY: Mainnet-Only (No Local Testing)
CANONICAL SCRIPT: src/daopad/deploy.sh
DOCUMENTATION: src/daopad/CLAUDE.md

For detailed information, see:
- DAOPAD_DEPLOYMENT_ANALYSIS.md (comprehensive technical guide)
- DAOPAD_DEPLOYMENT_SUMMARY.txt (quick reference)
- src/daopad/CLAUDE.md (official documentation)

